<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Send a Message to Space</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Courier New', monospace;
            overflow: hidden;
            background: #000;
            color: #fff;
        }

        #canvas-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }

        #ui-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 2;
            pointer-events: none;
        }

        #title {
            display: none;
        }

        #message-form {
            position: absolute;
            bottom: 60px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 20, 40, 0.8);
            padding: 30px;
            border-radius: 15px;
            border: 2px solid #00ffff;
            box-shadow: 0 0 30px rgba(0, 255, 255, 0.5);
            pointer-events: all;
            min-width: 400px;
        }

        #message-form h2 {
            color: #00ffff;
            margin-bottom: 20px;
            text-align: center;
            text-shadow: 0 0 10px #00ffff;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #00ffff;
            font-size: 14px;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 10px;
            background: rgba(0, 0, 0, 0.6);
            border: 1px solid #00ffff;
            border-radius: 5px;
            color: #fff;
            font-family: 'Courier New', monospace;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            box-shadow: 0 0 10px #00ffff;
        }

        #mood-buttons {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }

        .mood-btn {
            padding: 12px;
            background: rgba(0, 0, 0, 0.6);
            border: 2px solid;
            border-radius: 8px;
            color: #fff;
            cursor: pointer;
            transition: all 0.3s;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            pointer-events: all;
        }

        .mood-btn.hope {
            border-color: #00ffff;
        }

        .mood-btn.love {
            border-color: #ff00ff;
        }

        .mood-btn.dream {
            border-color: #ffff00;
        }

        .mood-btn.gratitude {
            border-color: #00ff00;
        }

        .mood-btn:hover {
            transform: scale(1.05);
        }

        .mood-btn.active {
            box-shadow: 0 0 20px currentColor;
        }

        .mood-btn.hope.active {
            box-shadow: 0 0 20px #00ffff;
        }

        .mood-btn.love.active {
            box-shadow: 0 0 20px #ff00ff;
        }

        .mood-btn.dream.active {
            box-shadow: 0 0 20px #ffff00;
        }

        .mood-btn.gratitude.active {
            box-shadow: 0 0 20px #00ff00;
        }

        #send-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(45deg, #00ffff, #0088ff);
            border: none;
            border-radius: 8px;
            color: #000;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 20px;
            transition: all 0.3s;
            pointer-events: all;
            font-family: 'Courier New', monospace;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        #send-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 0 30px #00ffff;
        }

        #filter-container {
            position: absolute;
            top: 30px;
            left: 30px;
            pointer-events: all;
        }

        #filter-container label {
            display: block;
            color: #00ffff;
            font-size: 12px;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        #country-filter {
            padding: 10px 20px;
            background: rgba(0, 20, 40, 0.8);
            border: 2px solid #00ffff;
            border-radius: 8px;
            color: #fff;
            font-family: 'Courier New', monospace;
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.3);
        }

        #country-filter:focus {
            outline: none;
            box-shadow: 0 0 30px #00ffff;
        }

        .message-tooltip {
            position: absolute;
            background: rgba(0, 20, 40, 0.95);
            padding: 15px 20px;
            border-radius: 10px;
            border: 2px solid;
            max-width: 300px;
            pointer-events: none;
            z-index: 1000;
            font-size: 14px;
            line-height: 1.6;
        }

        .char-count {
            text-align: right;
            font-size: 12px;
            color: #00ffff;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div id="canvas-container"></div>
    
    <div id="ui-container">
        <h1 id="title">SEND A MESSAGE TO SPACE</h1>
        
        <div id="filter-container">
            <label>Filter by country:</label>
            <select id="country-filter">
                <option value="all">All European Countries</option>
                <option value="Albania">Albania</option>
                <option value="Andorra">Andorra</option>
                <option value="Austria">Austria</option>
                <option value="Belgium">Belgium</option>
                <option value="Bosnia and Herzegovina">Bosnia and Herzegovina</option>
                <option value="Bulgaria">Bulgaria</option>
                <option value="Croatia">Croatia</option>
                <option value="Cyprus">Cyprus</option>
                <option value="Czech Republic">Czech Republic</option>
                <option value="Denmark">Denmark</option>
                <option value="Estonia">Estonia</option>
                <option value="Finland">Finland</option>
                <option value="France">France</option>
                <option value="Germany">Germany</option>
                <option value="Greece">Greece</option>
                <option value="Hungary">Hungary</option>
                <option value="Iceland">Iceland</option>
                <option value="Ireland">Ireland</option>
                <option value="Italy">Italy</option>
                <option value="Kosovo">Kosovo</option>
                <option value="Latvia">Latvia</option>
                <option value="Liechtenstein">Liechtenstein</option>
                <option value="Lithuania">Lithuania</option>
                <option value="Luxembourg">Luxembourg</option>
                <option value="Malta">Malta</option>
                <option value="Moldova">Moldova</option>
                <option value="Monaco">Monaco</option>
                <option value="Montenegro">Montenegro</option>
                <option value="Netherlands">Netherlands</option>
                <option value="North Macedonia">North Macedonia</option>
                <option value="Norway">Norway</option>
                <option value="Poland">Poland</option>
                <option value="Portugal">Portugal</option>
                <option value="Romania">Romania</option>
                <option value="San Marino">San Marino</option>
                <option value="Serbia">Serbia</option>
                <option value="Slovakia">Slovakia</option>
                <option value="Slovenia">Slovenia</option>
                <option value="Spain">Spain</option>
                <option value="Sweden">Sweden</option>
                <option value="Switzerland">Switzerland</option>
                <option value="Ukraine">Ukraine</option>
                <option value="United Kingdom">United Kingdom</option>
                <option value="Vatican City">Vatican City</option>
            </select>
        </div>

        <div id="message-form">
            <h2>‚ú® YOUR MESSAGE ‚ú®</h2>
            
            <div class="form-group">
                <label for="message-text">Message (max 100 characters)</label>
                <input type="text" id="message-text" maxlength="100" placeholder="Write your wish to the universe...">
                <div class="char-count"><span id="char-counter">0</span>/100</div>
            </div>

            <div class="form-group">
                <label>Choose your mood:</label>
                <div id="mood-buttons">
                    <button class="mood-btn hope" data-mood="hope">üíô Hope</button>
                    <button class="mood-btn love" data-mood="love">üíú Love</button>
                    <button class="mood-btn dream" data-mood="dream">üíõ Dream</button>
                    <button class="mood-btn gratitude" data-mood="gratitude">üíö Gratitude</button>
                </div>
            </div>

            <div class="form-group">
                <label for="country-select">Your Country:</label>
                <select id="country-select">
                    <option value="">Select your country...</option>
                    <option value="Albania">Albania</option>
                    <option value="Andorra">Andorra</option>
                    <option value="Austria">Austria</option>
                    <option value="Belgium">Belgium</option>
                    <option value="Bosnia and Herzegovina">Bosnia and Herzegovina</option>
                    <option value="Bulgaria">Bulgaria</option>
                    <option value="Croatia">Croatia</option>
                    <option value="Cyprus">Cyprus</option>
                    <option value="Czech Republic">Czech Republic</option>
                    <option value="Denmark">Denmark</option>
                    <option value="Estonia">Estonia</option>
                    <option value="Finland">Finland</option>
                    <option value="France">France</option>
                    <option value="Germany">Germany</option>
                    <option value="Greece">Greece</option>
                    <option value="Hungary">Hungary</option>
                    <option value="Iceland">Iceland</option>
                    <option value="Ireland">Ireland</option>
                    <option value="Italy">Italy</option>
                    <option value="Kosovo">Kosovo</option>
                    <option value="Latvia">Latvia</option>
                    <option value="Liechtenstein">Liechtenstein</option>
                    <option value="Lithuania">Lithuania</option>
                    <option value="Luxembourg">Luxembourg</option>
                    <option value="Malta">Malta</option>
                    <option value="Moldova">Moldova</option>
                    <option value="Monaco">Monaco</option>
                    <option value="Montenegro">Montenegro</option>
                    <option value="Netherlands">Netherlands</option>
                    <option value="North Macedonia">North Macedonia</option>
                    <option value="Norway">Norway</option>
                    <option value="Poland">Poland</option>
                    <option value="Portugal">Portugal</option>
                    <option value="Romania">Romania</option>
                    <option value="San Marino">San Marino</option>
                    <option value="Serbia">Serbia</option>
                    <option value="Slovakia">Slovakia</option>
                    <option value="Slovenia">Slovenia</option>
                    <option value="Spain">Spain</option>
                    <option value="Sweden">Sweden</option>
                    <option value="Switzerland">Switzerland</option>
                    <option value="Ukraine">Ukraine</option>
                    <option value="United Kingdom">United Kingdom</option>
                    <option value="Vatican City">Vatican City</option>
                </select>
            </div>

            <button id="send-btn">üöÄ Send to Space</button>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        // Scene setup
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.getElementById('canvas-container').appendChild(renderer.domElement);
        
        camera.position.z = 15;

        // Starfield
        const starsGeometry = new THREE.BufferGeometry();
        const starsMaterial = new THREE.PointsMaterial({
            color: 0xffffff,
            size: 0.7,
            transparent: true
        });

        const starsVertices = [];
        for (let i = 0; i < 10000; i++) {
            const x = (Math.random() - 0.5) * 2000;
            const y = (Math.random() - 0.5) * 2000;
            const z = (Math.random() - 0.5) * 2000;
            starsVertices.push(x, y, z);
        }

        starsGeometry.setAttribute('position', new THREE.Float32BufferAttribute(starsVertices, 3));
        const stars = new THREE.Points(starsGeometry, starsMaterial);
        scene.add(stars);

        // Planets
        const planetGeometry = new THREE.SphereGeometry(2, 32, 32);
        
        const planet1Material = new THREE.MeshBasicMaterial({
            color: 0x4169e1,
            wireframe: false
        });
        const planet1 = new THREE.Mesh(planetGeometry, planet1Material);
        planet1.position.set(-20, 5, -30);
        scene.add(planet1);

        const planet2Geometry = new THREE.SphereGeometry(1.5, 32, 32);
        const planet2Material = new THREE.MeshBasicMaterial({
            color: 0xff69b4,
            wireframe: false
        });
        const planet2 = new THREE.Mesh(planet2Geometry, planet2Material);
        planet2.position.set(15, -8, -25);
        scene.add(planet2);

        const planet3Geometry = new THREE.SphereGeometry(2.5, 32, 32);
        const planet3Material = new THREE.MeshBasicMaterial({
            color: 0x9370db,
            wireframe: false
        });
        const planet3 = new THREE.Mesh(planet3Geometry, planet3Material);
        planet3.position.set(0, 10, -40);
        scene.add(planet3);

        // Messages array
        let messages = [];
        let selectedMood = 'hope';

        const moodColors = {
            hope: 0x00ffff,
            love: 0xff00ff,
            dream: 0xffff00,
            gratitude: 0x00ff00
        };

        // Form handlers
        const messageInput = document.getElementById('message-text');
        const charCounter = document.getElementById('char-counter');
        const moodButtons = document.querySelectorAll('.mood-btn');
        const sendBtn = document.getElementById('send-btn');
        const countrySelect = document.getElementById('country-select');
        const countryFilter = document.getElementById('country-filter');

        messageInput.addEventListener('input', () => {
            charCounter.textContent = messageInput.value.length;
        });

        moodButtons.forEach(btn => {
            btn.addEventListener('click', () => {
                moodButtons.forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                selectedMood = btn.dataset.mood;
            });
        });

        // Set default mood
        document.querySelector('.mood-btn.hope').classList.add('active');

        // Create message in 3D space
        function createMessage(text, mood, country) {
            const canvas = document.createElement('canvas');
            const context = canvas.getContext('2d');
            canvas.width = 512;
            canvas.height = 256;

            context.fillStyle = 'rgba(0, 0, 0, 0.7)';
            context.fillRect(0, 0, canvas.width, canvas.height);

            context.font = 'bold 24px Courier New';
            context.fillStyle = `#${moodColors[mood].toString(16).padStart(6, '0')}`;
            context.textAlign = 'center';
            context.textBaseline = 'middle';
            
            const words = text.split(' ');
            let line = '';
            let y = canvas.height / 2 - 20;
            
            words.forEach((word, i) => {
                const testLine = line + word + ' ';
                const metrics = context.measureText(testLine);
                if (metrics.width > canvas.width - 40 && i > 0) {
                    context.fillText(line, canvas.width / 2, y);
                    line = word + ' ';
                    y += 30;
                } else {
                    line = testLine;
                }
            });
            context.fillText(line, canvas.width / 2, y);

            const texture = new THREE.CanvasTexture(canvas);
            const material = new THREE.SpriteMaterial({
                map: texture,
                transparent: true
            });

            const sprite = new THREE.Sprite(material);
            sprite.scale.set(8, 4, 1);

            // Random starting position
            sprite.position.set(
                (Math.random() - 0.5) * 40,
                (Math.random() - 0.5) * 30,
                -50
            );

            const messageData = {
                sprite: sprite,
                text: text,
                mood: mood,
                country: country,
                velocity: {
                    x: (Math.random() - 0.5) * 0.1,
                    y: (Math.random() - 0.5) * 0.1,
                    z: 0.15
                },
                lifetime: 0,
                maxLifetime: 60 * 2 // 60 seconds at 60fps
            };

            scene.add(sprite);
            messages.push(messageData);

            return messageData;
        }

        // Send message
        sendBtn.addEventListener('click', () => {
            const text = messageInput.value.trim();
            const country = countrySelect.value;

            if (!text) {
                alert('Please write a message!');
                return;
            }

            if (!country) {
                alert('Please select your country!');
                return;
            }

            // Create message locally
            createMessage(text, selectedMood, country);

            // TODO: Send to n8n webhook here
            console.log('Sending message:', { text, mood: selectedMood, country });

            // Reset form
            messageInput.value = '';
            charCounter.textContent = '0';
            alert('Your message has been sent to space! ‚ú®');
        });

        // Filter messages
        countryFilter.addEventListener('change', () => {
            const filterValue = countryFilter.value;
            
            messages.forEach(msg => {
                if (filterValue === 'all' || msg.country === filterValue) {
                    msg.sprite.visible = true;
                } else {
                    msg.sprite.visible = false;
                }
            });
        });

        // Mouse interaction
        const raycaster = new THREE.Raycaster();
        const mouse = new THREE.Vector2();
        let tooltip = null;

        renderer.domElement.addEventListener('mousemove', (event) => {
            mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;

            raycaster.setFromCamera(mouse, camera);
            const intersects = raycaster.intersectObjects(messages.map(m => m.sprite));

            if (tooltip) {
                tooltip.remove();
                tooltip = null;
            }

            if (intersects.length > 0) {
                const messageData = messages.find(m => m.sprite === intersects[0].object);
                if (messageData) {
                    tooltip = document.createElement('div');
                    tooltip.className = 'message-tooltip';
                    tooltip.style.borderColor = `#${moodColors[messageData.mood].toString(16).padStart(6, '0')}`;
                    tooltip.style.left = event.clientX + 10 + 'px';
                    tooltip.style.top = event.clientY + 10 + 'px';
                    tooltip.innerHTML = `
                        <strong style="color: #${moodColors[messageData.mood].toString(16).padStart(6, '0')}">${messageData.mood.toUpperCase()}</strong><br>
                        "${messageData.text}"<br>
                        <small style="color: #00ffff">from ${messageData.country}</small>
                    `;
                    document.body.appendChild(tooltip);
                }
            }
        });

        // Animation loop
        function animate() {
            requestAnimationFrame(animate);

            // Rotate stars slowly
            stars.rotation.y += 0.0002;

            // Rotate planets
            planet1.rotation.y += 0.005;
            planet2.rotation.y += 0.008;
            planet3.rotation.y += 0.003;

            // Update messages
            messages = messages.filter(msg => {
                msg.lifetime++;

                if (msg.lifetime >= msg.maxLifetime) {
                    scene.remove(msg.sprite);
                    return false;
                }

                msg.sprite.position.x += msg.velocity.x;
                msg.sprite.position.y += msg.velocity.y;
                msg.sprite.position.z += msg.velocity.z;

                // Fade out at end
                if (msg.lifetime > msg.maxLifetime * 0.8) {
                    const fadeProgress = (msg.lifetime - msg.maxLifetime * 0.8) / (msg.maxLifetime * 0.2);
                    msg.sprite.material.opacity = 1 - fadeProgress;
                }

                return true;
            });

            renderer.render(scene, camera);
        }

        // Handle window resize
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        // Add some demo messages
        setTimeout(() => {
            createMessage('Hope for peace ‚úåÔ∏è', 'hope', 'Ukraine');
        }, 1000);

        setTimeout(() => {
            createMessage('Love conquers all üíú', 'love', 'Spain');
        }, 3000);

        setTimeout(() => {
            createMessage('Dream big! ‚≠ê', 'dream', 'Poland');
        }, 5000);

        animate();
    </script>
</body>
</html>
